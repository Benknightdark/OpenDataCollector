admin:
  access_log_path: "/dev/null"
  address:
    socket_address:
      address: 0.0.0.0
      port_value: 8001
static_resources:
  listeners:
    - address:
        socket_address:
          address: 0.0.0.0
          port_value: 80
      filter_chains:
        - filters:
            - name: envoy.http_connection_manager
              config:
                codec_type: auto
                stat_prefix: ingress_http
                route_config:
                  name: open_data_service_route
                  virtual_hosts:
                    - name: open_data_service
                      domains:
                        - "*"
                      cors:
                        allow_origin_string_match:
                          - safe_regex:
                              google_re2: {}
                              regex: \*
                        allow_methods: "GET, POST, PUT, DELETE"
                        allow_headers: "authorization, content-type, x-requestid, x-requested-with"
                        allow_credentials: true
                      routes:
                        - name: "kao-service"
                          match:
                            prefix: "/kao-service/"
                          route:
                            auto_host_rewrite: true
                            prefix_rewrite: "/v1.0/invoke/kao-service/method/"
                            cluster: dapr
                        - name: "tainan-service"
                          match:
                            prefix: "/tainan-service/"
                          route:
                            auto_host_rewrite: true
                            prefix_rewrite: "/v1.0/invoke/tainan-service/method/"
                            cluster: dapr
                        - name: "pthg-service"
                          match:
                            prefix: "/pthg-service/"
                          route:
                            auto_host_rewrite: true
                            prefix_rewrite: "/v1.0/invoke/pthg-service/method/"
                            cluster: dapr
                        - name: "taichung-service"
                          match:
                            prefix: "/taichung-service/"
                          route:
                            auto_host_rewrite: true
                            prefix_rewrite: "/v1.0/invoke/taichung-service/method/"
                            cluster: dapr
                        - name: "auth-service"
                          match:
                            prefix: "/auth-service/"
                          route:
                            auto_host_rewrite: true
                            prefix_rewrite: "/v1.0/invoke/auth-service/method/"
                            cluster: dapr
                http_filters:
                  - name: envoy.cors

                  # - name: envoy.filters.http.jwt_authn
                  #   config:
                  #     providers:
                  #       jwt_provider:
                  #         issuer: user
                  #         local_jwks:
                  #           inline_string: |
                  #               {
                  #                   "keys": [
                  #                       {
                  #                           "p": "vc-xH1RK8JLuW9G6Wf54WufrgMN4wXI93UeXTBWTvqMD7SHe051mamyXSfHAXSmLLsEwhRUoSqfZ-aGgVsN5QKHP1HXRXaQXdiqUvTnifPBkWtKVtAa_QdF4ptu97izw3ilLUjawf4LuAuwAglEc6hRstED68fF4TVyGifzpEA8",
                  #                           "kty": "RSA",
                  #                           "q": "tJKQp1Ubaoepzy_MupXCLF-8Jym0eKyRf7On_9gzR3OX35go6U4WYl-n-9gyWMo587AgdB2HOwsuCv7NwRhOrz846umAA9Arxw22pEz85muZ29UtE001XAViMHLDSLGdeekZpzCR414p3vazV043_vhF0VfwL7AgKRWc_HQoj-8",
                  #                           "d": "LfYPbhvvFMeaPSJ_zzpqno8wHCyF-4FmKAo8RYPi40nIZYhZ66181MMDXtGZQHRmBuHLQlvw3M850Hw4IRTpJDLul24f9GA9SfX6V3pPGRAm3F_UMiWnydONm5iCvtylWQq65kcEpKCJjiXc0juDxGnvpCP52WLqHxRcbTizh47-473w17ZUCQkYYq8-Q4pfF0AuWXA254flPjFZBzdCD7fH2yjAqThLI9u2SvMx7cGTtXOafxrTKJAkivoXww2ouKE1LtaFEFyUIHVzo6yUY31bm4TXGc6PflrtuPE1VmmF3yWk6DvPbuH1cjbwN8hV-u_WRulI1e1hLCqSHzH9iQ",
                  #                           "e": "AQAB",
                  #                           "use": "enc",
                  #                           "kid": "kObpNGkB2nK1VwXL4EF7gRSfARoFGS8sUGlWcLTV57I",
                  #                           "qi": "jV9XgITO8Uf012QuSc_mSoR19Zr9h5--i07W4bi_MQ4gjcJHutpdAKfO0uqJgf9JwMOp90jRGg6k4kpeU7xOTK1d9Ua4r668X0_SyvmmIalr_Dk5Dt-9g6ucbDAPfYTPwbnIiI0NRusVX6riiUSlHzdQQfJn_rbq2zcX60zX_zI",
                  #                           "dp": "i5TqCcHxAgzq3_bQ9VEerKsUEjKs4ITkXY9CAZ90cKJsRru7ox6CrAyDDMuMzHW6dn128sbmRFA_CUYEJQnGZvMXZIPnnNcIscsKakTg-0PEaM2nbSXxC7PA5-N8PmQqFRWE4EZ7cKmV4ewvS6Xef3zZm4yVfco2z50VCvBDa50",
                  #                           "alg": "RSA1_5",
                  #                           "dq": "rYb7xBKhmiptIVIKKHSqeQI3Sltlt2H_IP2BQPh_rvaCyLjs9-e20yqhv__vwiv0rR5g0bVes3r28FIVYK7_TqIvDHEAOKngqBWhoxrpHnXhEcU24AmecaQqy-w9hqpJb1J2-JhQWnOvQTlK92ePoFLupVMg2nMjNNg0WNc387k",
                  #                           "n": "heK0PfBbOHJSqfZFP4qu1bbXjXIQETKb5-GlGngHLpenJYknWSJ7yAO71tHfBl4-nuQxHNMizgxRpqGhncpFmvUKMxN_CdsyeoS5w5Ay1VItP4Bhyf6cbgCtIUXeoVgkehKRy-gu7A4WycMWyAr97aGaKSQvNvfetKHkTJ1mY6rErwFD0w88q3WR4_YaRv8jalREhFyW5m0Dhbvc2wF0_0Hs2StlpO1XHsDJp1-dopxkc4npjICH5l1NpU6yNqU6qeodHH-OADHnRr2gCC8Ega07VKHsecZXqlK0wln18AssLhuPFBx9t-Uo0qmur-H7XHXo1DJtkHYoIcGOm-ZfAQ"
                  #                       }
                  #                   ]
                  #               }
                  #         forward: true
                  #         forward_payload_header: "plain-authorization"
                      # rules:
                      #   - match:
                      #       prefix: "/kao-service/"
                      #     requires:
                      #       provider_and_audiences:
                      #         provider_name: jwt_provider
                      #         # audiences: http://www.service.com
                  - name: envoy.router                              
                access_log:
                  - name: envoy.file_access_log
                    filter:
                      not_health_check_filter: {}
                    config:
                      json_format:
                        time: "%START_TIME%"
                        protocol: "%PROTOCOL%"
                        duration: "%DURATION%"
                        request_method: "%REQ(:METHOD)%"
                        request_host: "%REQ(HOST)%"
                        path: "%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%"
                        response_flags: "%RESPONSE_FLAGS%"
                        route_name: "%ROUTE_NAME%"
                        upstream_host: "%UPSTREAM_HOST%"
                        upstream_cluster: "%UPSTREAM_CLUSTER%"
                        upstream_local_address: "%UPSTREAM_LOCAL_ADDRESS%"
                      path: "/tmp/access.log"
  clusters:
    - name: dapr
      connect_timeout: 0.25s
      type: strict_dns
      lb_policy: round_robin
      hosts:
        - socket_address:
            address: 127.0.0.1
            port_value: 3500
